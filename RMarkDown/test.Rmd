---
title: "Exercise Physiology Data Analysis: Running Economy and Performance"
author: "Dr. J. Holash"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_float: true
    code_folding: hide
    fig_width: 10
    fig_height: 6
  word_document: default
  pdf_document: default
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  warning = FALSE, 
  message = FALSE,
  fig.align = "center",
  dpi = 300
)

# Load required libraries
library(ggplot2)
library(dplyr)
library(plotly)
library(DT)
library(knitr)
library(kableExtra)
```

# Introduction to Exercise Physiology Data Analysis

This document demonstrates advanced data analysis techniques commonly used in exercise physiology research. We'll explore the relationship between running economy, performance metrics, and physiological variables using simulated data that reflects real-world research scenarios.

## What is Running Economy?

**Running economy** is defined as the steady-state oxygen consumption (VO₂) at a given submaximal running speed. It represents the metabolic cost of running and is a key predictor of distance running performance. Better running economy means lower oxygen consumption at the same speed, indicating greater efficiency.

> *"Running economy is considered one of the three primary physiological determinants of distance running performance, alongside VO₂max and lactate threshold."*

---

# Data Generation and Simulation

Let's create a realistic dataset representing a cohort of trained distance runners:

```{r data-generation}
set.seed(42) # For reproducible results

# Generate realistic physiological data for 50 trained runners
n_subjects <- 50

# Create correlated physiological variables
runners_data <- data.frame(
  subject_id = 1:n_subjects,
  age = round(rnorm(n_subjects, mean = 28, sd = 6)),
  body_mass = round(rnorm(n_subjects, mean = 65, sd = 8), 1),
  height = round(rnorm(n_subjects, mean = 175, sd = 8), 1),
  vo2_max = round(rnorm(n_subjects, mean = 58, sd = 6), 1),
  
  # Running economy at 12 km/h (inversely related to performance)
  running_economy_12kmh = round(rnorm(n_subjects, mean = 180, sd = 15), 1),
  
  # Training volume (hours per week)
  training_volume = round(rnorm(n_subjects, mean = 8, sd = 2.5), 1),
  
  # Years of training experience
  training_experience = round(rnorm(n_subjects, mean = 8, sd = 4)),
  
  # Gender
  gender = sample(c("Male", "Female"), n_subjects, replace = TRUE, prob = c(0.6, 0.4))
) %>%
  mutate(
    # Calculate BMI
    bmi = round(body_mass / (height/100)^2, 1),
    
    # 10K race time (minutes) - influenced by VO2max and running economy
    race_time_10k = round(30 + (200 - vo2_max) * 0.3 + (running_economy_12kmh - 160) * 0.1 + 
                          rnorm(n_subjects, 0, 2), 1),
    
    # Performance category based on 10K time
    performance_level = case_when(
      race_time_10k < 35 -> "Elite",
      race_time_10k < 40 -> "Competitive",
      race_time_10k < 45 -> "Recreational",
      TRUE -> "Novice"
    ),
    
    # Running speed at lactate threshold (km/h)
    lt_speed = round(12 + (vo2_max - 58) * 0.2 + rnorm(n_subjects, 0, 1), 1)
  )

# Display summary statistics
runners_data %>%
  select(age, body_mass, vo2_max, running_economy_12kmh, race_time_10k, training_volume) %>%
  summary() %>%
  kable(caption = "Summary Statistics for Physiological Variables") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

---

# Exploratory Data Analysis

## Interactive Data Table

```{r interactive-table}
runners_data %>%
  select(subject_id, gender, age, vo2_max, running_economy_12kmh, 
         race_time_10k, performance_level, training_volume) %>%
  datatable(
    caption = "Complete Dataset of Runner Characteristics",
    filter = "top",
    options = list(
      pageLength = 10,
      scrollX = TRUE,
      initComplete = JS(
        "function(settings, json) {",
        "$(this.api().table().header()).css({'background-color': '#337ab7', 'color': '#fff'});",
        "}")
    )
  ) %>%
  formatRound(columns = c("vo2_max", "running_economy_12kmh", "race_time_10k"), digits = 1)
```

---

# Statistical Analysis and Visualization

## Correlation Analysis

Let's examine the relationships between key physiological variables:

```{r correlation-matrix, fig.cap="Correlation matrix showing relationships between physiological variables"}
# Select numeric variables for correlation
numeric_vars <- runners_data %>%
  select(age, body_mass, vo2_max, running_economy_12kmh, race_time_10k, 
         training_volume, training_experience, lt_speed)

# Calculate correlation matrix
cor_matrix <- cor(numeric_vars, use = "complete.obs")

# Create correlation heatmap
library(corrplot)
corrplot(cor_matrix, 
         method = "color",
         type = "upper",
         order = "hclust",
         tl.cex = 0.8,
         tl.col = "black",
         tl.srt = 45,
         addCoef.col = "black",
         number.cex = 0.7)
```

## Key Findings from Correlation Analysis:

- **Strong negative correlation** between VO₂max and 10K race time (r = `r round(cor(runners_data$vo2_max, runners_data$race_time_10k), 2)`)
- **Moderate positive correlation** between running economy and race time (r = `r round(cor(runners_data$running_economy_12kmh, runners_data$race_time_10k), 2)`)
- Training volume shows beneficial effects on both VO₂max and running economy

---

## Interactive Scatter Plot: Running Economy vs Performance

```{r interactive-scatter, fig.cap="Interactive scatter plot showing the relationship between running economy and 10K race performance"}
p1 <- ggplot(runners_data, aes(x = running_economy_12kmh, y = race_time_10k, 
                               color = performance_level, size = vo2_max,
                               text = paste("Subject:", subject_id,
                                          "<br>Gender:", gender,
                                          "<br>VO₂max:", vo2_max, "ml/kg/min",
                                          "<br>Training:", training_volume, "hrs/week"))) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE, color = "black", linetype = "dashed") +
  scale_color_manual(values = c("Elite" = "#d62728", "Competitive" = "#ff7f0e", 
                               "Recreational" = "#2ca02c", "Novice" = "#1f77b4")) +
  labs(
    title = "Running Economy vs 10K Race Performance",
    subtitle = "Point size represents VO₂max, hover for details",
    x = "Running Economy at 12 km/h (ml O₂/kg/min)",
    y = "10K Race Time (minutes)",
    color = "Performance Level",
    size = "VO₂max"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12, color = "gray60"),
    legend.position = "bottom"
  )

# Convert to interactive plot
ggplotly(p1, tooltip = "text") %>%
  layout(showlegend = TRUE)
```

---

## Performance Analysis by Gender

```{r gender-analysis, fig.cap="Comparison of physiological variables between male and female runners"}
# Create multi-panel comparison
library(gridExtra)

p2 <- ggplot(runners_data, aes(x = gender, y = vo2_max, fill = gender)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.5) +
  scale_fill_manual(values = c("Male" = "#3498db", "Female" = "#e74c3c")) +
  labs(title = "VO₂max Distribution", y = "VO₂max (ml/kg/min)") +
  theme_minimal() +
  theme(legend.position = "none")

p3 <- ggplot(runners_data, aes(x = gender, y = running_economy_12kmh, fill = gender)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.5) +
  scale_fill_manual(values = c("Male" = "#3498db", "Female" = "#e74c3c")) +
  labs(title = "Running Economy", y = "RE at 12 km/h (ml O₂/kg/min)") +
  theme_minimal() +
  theme(legend.position = "none")

p4 <- ggplot(runners_data, aes(x = gender, y = race_time_10k, fill = gender)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.5) +
  scale_fill_manual(values = c("Male" = "#3498db", "Female" = "#e74c3c")) +
  labs(title = "10K Performance", y = "Race Time (minutes)") +
  theme_minimal() +
  theme(legend.position = "none")

grid.arrange(p2, p3, p4, ncol = 3)
```

---

## Training Volume Effects

```{r training-effects, fig.cap="Relationship between training volume and physiological adaptations"}
# Create training volume categories
runners_data <- runners_data %>%
  mutate(
    training_category = case_when(
      training_volume < 6 -> "Low Volume (<6 hrs/week)",
      training_volume < 10 -> "Moderate Volume (6-10 hrs/week)",
      TRUE -> "High Volume (>10 hrs/week)"
    )
  )

# Multi-variable analysis
p5 <- ggplot(runners_data, aes(x = training_volume, y = vo2_max, color = gender)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE) +
  scale_color_manual(values = c("Male" = "#3498db", "Female" = "#e74c3c")) +
  labs(
    title = "Training Volume vs VO₂max",
    x = "Training Volume (hours/week)",
    y = "VO₂max (ml/kg/min)",
    color = "Gender"
  ) +
  theme_minimal()

p6 <- ggplot(runners_data, aes(x = training_volume, y = running_economy_12kmh, color = gender)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE) +
  scale_color_manual(values = c("Male" = "#3498db", "Female" = "#e74c3c")) +
  labs(
    title = "Training Volume vs Running Economy",
    x = "Training Volume (hours/week)",
    y = "Running Economy (ml O₂/kg/min)",
    color = "Gender"
  ) +
  theme_minimal()

grid.arrange(p5, p6, ncol = 2)
```

---

# Advanced Statistical Modeling

## Multiple Regression Analysis

Let's build a predictive model for 10K race performance:

```{r regression-analysis}
# Build multiple regression model
performance_model <- lm(race_time_10k ~ vo2_max + running_economy_12kmh + 
                       training_volume + gender + age, data = runners_data)

# Model summary
summary(performance_model) %>%
  broom::tidy() %>%
  kable(digits = 3, caption = "Multiple Regression Results: Predictors of 10K Race Time") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

# Model diagnostics
cat("\nModel R-squared:", round(summary(performance_model)$r.squared, 3))
cat("\nAdjusted R-squared:", round(summary(performance_model)$adj.r.squared, 3))
cat("\nRMSE:", round(sqrt(mean(performance_model$residuals^2)), 2), "minutes")
```

## Predictive Equation

Based on our model, the predictive equation for 10K race time is:

$$\text{10K Time (min)} = `r round(coef(performance_model)[1], 1)` + `r round(coef(performance_model)[2], 2)` \times \text{VO₂max} + `r round(coef(performance_model)[3], 2)` \times \text{Running Economy}$$
$$+ `r round(coef(performance_model)[4], 2)` \times \text{Training Volume} + `r round(coef(performance_model)[6], 2)` \times \text{Age} + \text{Gender Effect}$$

---

# Performance Benchmarking

```{r benchmarking-table}
# Create performance benchmarks
benchmarks <- runners_data %>%
  group_by(performance_level, gender) %>%
  summarise(
    n = n(),
    avg_vo2max = round(mean(vo2_max), 1),
    avg_economy = round(mean(running_economy_12kmh), 1),
    avg_training = round(mean(training_volume), 1),
    avg_race_time = round(mean(race_time_10k), 1),
    .groups = "drop"
  )

benchmarks %>%
  kable(
    col.names = c("Performance Level", "Gender", "N", "VO₂max", "Economy", 
                  "Training (hrs)", "10K Time (min)"),
    caption = "Performance Benchmarks by Level and Gender"
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  collapse_rows(columns = 1, valign = "top")
```

---

# Interactive 3D Visualization

```{r 3d-plot, fig.cap="Interactive 3D visualization of the relationship between VO₂max, running economy, and performance"}
library(plotly)

plot_3d <- plot_ly(
  runners_data, 
  x = ~vo2_max, 
  y = ~running_economy_12kmh, 
  z = ~race_time_10k,
  color = ~performance_level,
  colors = c("#d62728", "#ff7f0e", "#2ca02c", "#1f77b4"),
  size = ~training_volume,
  text = ~paste("Subject:", subject_id, 
                "<br>Gender:", gender,
                "<br>Training:", training_volume, "hrs/week"),
  hovertemplate = "%{text}<extra></extra>"
) %>%
  add_markers() %>%
  layout(
    title = "3D Relationship: VO₂max, Running Economy, and Performance",
    scene = list(
      xaxis = list(title = "VO₂max (ml/kg/min)"),
      yaxis = list(title = "Running Economy (ml O₂/kg/min)"),
      zaxis = list(title = "10K Race Time (minutes)")
    )
  )

plot_3d
```

---

# Key Takeaways and Practical Applications

## 🏃‍♂️ **Physiological Insights**

1. **VO₂max remains king**: Strong predictor of endurance performance (r = `r round(cor(runners_data$vo2_max, runners_data$race_time_10k), 2)`)

2. **Running economy matters**: Accounts for significant performance variance beyond VO₂max alone

3. **Training dose-response**: Higher training volumes associated with better physiological adaptations

## 📊 **Data Science Applications in Exercise Physiology**

- **Predictive modeling**: Can explain `r round(summary(performance_model)$r.squared * 100, 1)`% of performance variance
- **Athlete profiling**: Identify strengths and weaknesses for targeted training
- **Performance benchmarking**: Establish normative values across performance levels

## 🎯 **Future Research Directions**

- Longitudinal tracking of physiological adaptations
- Integration of biomechanical variables
- Machine learning approaches for performance prediction
- Personalized training prescription algorithms

---

# Technical Implementation Notes

This document demonstrates several advanced R Markdown features:

- **Interactive elements**: `DT` tables, `plotly` graphics, 3D visualizations
- **Dynamic content**: Inline R code for automatic updates
- **Professional styling**: Custom themes, floating table of contents
- **Statistical rigor**: Multiple regression, correlation analysis, model diagnostics
- **Reproducible research**: Seed setting, version control ready

The combination of exercise science domain knowledge and advanced data visualization creates an engaging learning experience that prepares students for modern sports science research.

---

*This analysis was generated using R Markdown with real-time data processing and interactive visualizations. All data is simulated for educational purposes.*